<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bloxy Rbx World - Parrainage</title>
</head>
<body>
<h1>Bloxy Rbx World</h1>
<p>Code de parrainage : <span id="codeDisplay">Chargement...</span></p>
<button id="openAppBtn" style="display:none;">Ouvrir l'app</button>

<script>
const APP_SCHEME = 'BloxyRbxWorld';
const PACKAGE_NAME = 'com.Dauof.BloxingWorld_Blox_World.com';
const BASE_PLAY_STORE_URL = 'https://play.google.com/store/apps/details';

function getReferralCode() {
    return new URLSearchParams(window.location.search).get('code');
}

function getPlayStoreUrlWithReferrer(code) {
    return `${BASE_PLAY_STORE_URL}?id=${PACKAGE_NAME}&referrer=${encodeURIComponent(code)}`;
}

function openApp(code) {
    const deepLink = `${APP_SCHEME}://referral/${code}`;
    window.location.href = deepLink;

    // للتجربة، تحويل للـ Play Store بعد ثانيتين إذا لم يفتح التطبيق
    setTimeout(() => {
        window.location.href = getPlayStoreUrlWithReferrer(code);
    }, 2000);
}

window.addEventListener('DOMContentLoaded', () => {
    const code = getReferralCode();
    const codeDisplay = document.getElementById('codeDisplay');
    const openAppBtn = document.getElementById('openAppBtn');

    if (code) {
        codeDisplay.textContent = code;
        openAppBtn.style.display = 'inline-block';
        openAppBtn.addEventListener('click', e => { e.preventDefault(); openApp(code); });

        // فتح تلقائي بعد ثانية
        setTimeout(() => { openApp(code); }, 1000);
    } else {
        codeDisplay.textContent = 'Code manquant';
    }
});
</script>
</body>
</html>
